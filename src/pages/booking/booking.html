<div class="booking-page">
  <div class="booking-container">

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !trailer" class="error-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      <h2>{{ error }}</h2>
      <a routerLink="/trailers" class="btn btn-primary">Browse Trailers</a>
    </div>

    <!-- Success State -->
    <div *ngIf="success" class="success-state">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      </div>
      <h1>Booking Confirmed!</h1>
      <p>Your trailer has been reserved successfully.</p>

      <div class="success-details">
        <div class="detail-row">
          <span class="label">Trailer:</span>
          <span class="value">{{ trailer?.title }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Pickup Date:</span>
          <span class="value">{{ startDate }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Return Date:</span>
          <span class="value">{{ endDate }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Total:</span>
          <span class="value total">{{ formatCurrency(totalPrice) }}</span>
        </div>
      </div>

      <div class="success-actions">
        <a routerLink="/profile" class="btn btn-primary">View My Bookings</a>
        <a routerLink="/trailers" class="btn btn-secondary">Browse More Trailers</a>
      </div>
    </div>

    <!-- Booking Form -->
    <div *ngIf="trailer && !success" class="booking-content">

      <!-- Header -->
      <div class="booking-header">
        <a routerLink="/trailers" class="back-link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Back to Trailers
        </a>
        <h1>Book Your Trailer</h1>
      </div>

      <div class="booking-grid">

        <!-- Left: Form -->
        <div class="booking-form-section">

          <!-- Error Banner -->
          <div *ngIf="error" class="error-banner">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            <span>{{ error }}</span>
          </div>

          <form (ngSubmit)="handleSubmit()" class="booking-form">

            <!-- Date Selection -->
            <div class="form-section">
              <h3>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Select Dates
              </h3>

              <div class="date-inputs">
                <div class="form-group">
                  <label for="startDate">Pickup Date</label>
                  <input
                    type="date"
                    id="startDate"
                    [(ngModel)]="startDate"
                    name="startDate"
                    [min]="minDate"
                    (change)="onDateChange()"
                    required
                  >
                </div>

                <div class="form-group">
                  <label for="endDate">Return Date</label>
                  <input
                    type="date"
                    id="endDate"
                    [(ngModel)]="endDate"
                    name="endDate"
                    [min]="startDate || minDate"
                    (change)="onDateChange()"
                    required
                  >
                </div>
              </div>

              <div *ngIf="unavailableDates.length > 0" class="unavailable-notice">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>Some dates are unavailable for this trailer</span>
              </div>
            </div>

            <!-- Location Selection -->
            <div class="form-section">
              <h3>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                Pickup & Return
              </h3>

              <div class="form-group">
                <label for="pickupLocation">Pickup Location</label>
                <select
                  id="pickupLocation"
                  [(ngModel)]="pickupLocation"
                  name="pickupLocation"
                  (change)="onSameDropoffChange()"
                  required
                >
                  <option value="" disabled>Select location</option>
                  <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
                </select>
              </div>

              <label class="checkbox-wrapper">
                <input
                  type="checkbox"
                  [(ngModel)]="sameDropoff"
                  name="sameDropoff"
                  (change)="onSameDropoffChange()"
                >
                <span class="checkmark"></span>
                <span>Return to same location</span>
              </label>

              <div *ngIf="!sameDropoff" class="form-group">
                <label for="dropoffLocation">Return Location</label>
                <select
                  id="dropoffLocation"
                  [(ngModel)]="dropoffLocation"
                  name="dropoffLocation"
                  required
                >
                  <option value="" disabled>Select location</option>
                  <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
                </select>
              </div>
            </div>

            <!-- Notes -->
            <div class="form-section">
              <h3>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                </svg>
                Additional Notes (Optional)
              </h3>

              <div class="form-group">
                <textarea
                  id="notes"
                  [(ngModel)]="notes"
                  name="notes"
                  rows="3"
                  placeholder="Any special requests or information..."
                  maxlength="500"
                ></textarea>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn-submit" [disabled]="isLoading() || !startDate || !endDate">
              <span *ngIf="!isLoading()">Confirm Booking</span>
              <span *ngIf="isLoading()" class="loading-spinner-small"></span>
            </button>
          </form>
        </div>

        <!-- Right: Summary -->
        <div class="booking-summary-section">
          <div class="summary-card">
            <h3>Booking Summary</h3>

            <!-- Trailer Info -->
            <div class="trailer-preview">
              <div class="trailer-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="1" y="3" width="15" height="13"/>
                  <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
                  <circle cx="5.5" cy="18.5" r="2.5"/>
                  <circle cx="18.5" cy="18.5" r="2.5"/>
                </svg>
              </div>
              <div class="trailer-info">
                <h4>{{ trailer.title }}</h4>
                <p>{{ trailer.type }} â€¢ {{ trailer.location }}</p>
              </div>
            </div>

            <div class="summary-divider"></div>

            <!-- Price Breakdown -->
            <div class="price-breakdown">
              <div class="price-row">
                <span>Daily Rate</span>
                <span>{{ formatCurrency(trailer.price) }}</span>
              </div>

              <div class="price-row" *ngIf="totalDays > 0">
                <span>Duration</span>
                <span>{{ totalDays }} day{{ totalDays > 1 ? 's' : '' }}</span>
              </div>

              <div *ngIf="!sameDropoff && dropoffLocation && dropoffLocation !== pickupLocation" class="price-row">
                <span>Different Return Location</span>
                <span class="free-badge">FREE</span>
              </div>
            </div>

            <div class="summary-divider"></div>

            <!-- Total -->
            <div class="total-row">
              <span>Total</span>
              <span class="total-price">{{ totalDays > 0 ? formatCurrency(totalPrice) : '--' }}</span>
            </div>

            <!-- Info -->
            <div class="summary-info">
              <div class="info-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>Free cancellation up to 24 hours before pickup</span>
              </div>
              <div class="info-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <span>Secure booking - pay at pickup</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
