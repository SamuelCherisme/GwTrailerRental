<div class="my-bookings-page">
  <div class="bookings-container">

    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>My Bookings</h1>
        <p>View and manage your trailer rentals</p>
      </div>
      <a routerLink="/trailers" class="btn btn-primary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        New Booking
      </a>
    </div>

    <!-- Filters -->
    <div class="filters-bar">
      <button
        *ngFor="let filter of filters"
        class="filter-btn"
        [class.active]="activeFilter === filter.key"
        (click)="setFilter(filter.key)"
      >
        {{ filter.label }}
        <span class="filter-count" *ngIf="getFilterCount(filter.key) > 0">
          {{ getFilterCount(filter.key) }}
        </span>
      </button>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading()" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading your bookings...</p>
    </div>

    <!-- Error -->
    <div *ngIf="error" class="error-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h3>{{ error }}</h3>
      <button class="btn btn-secondary" (click)="loadBookings()">Try Again</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading() && !error && filteredBookings.length === 0" class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="1" y="3" width="15" height="13"/>
        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
        <circle cx="5.5" cy="18.5" r="2.5"/>
        <circle cx="18.5" cy="18.5" r="2.5"/>
      </svg>
      <h3 *ngIf="activeFilter === 'all'">No bookings yet</h3>
      <h3 *ngIf="activeFilter !== 'all'">No {{ activeFilter }} bookings</h3>
      <p *ngIf="activeFilter === 'all'">Start by browsing our available trailers</p>
      <a routerLink="/trailers" class="btn btn-primary" *ngIf="activeFilter === 'all'">Browse Trailers</a>
      <button class="btn btn-secondary" *ngIf="activeFilter !== 'all'" (click)="setFilter('all')">View All Bookings</button>
    </div>

    <!-- Bookings List -->
    <div *ngIf="!isLoading() && !error && filteredBookings.length > 0" class="bookings-list">
      <div class="booking-card" *ngFor="let booking of filteredBookings">

        <!-- Card Header -->
        <div class="booking-header">
          <div class="trailer-info">
            <div class="trailer-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="3" width="15" height="13"/>
                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
                <circle cx="5.5" cy="18.5" r="2.5"/>
                <circle cx="18.5" cy="18.5" r="2.5"/>
              </svg>
            </div>
            <div>
              <h3>{{ booking.trailerTitle }}</h3>
              <p>{{ booking.trailerDetails?.type || 'Trailer' }} â€¢ {{ booking.pickupLocation }}</p>
            </div>
          </div>
          <span class="status-badge" [ngClass]="getStatusClass(booking.status)">
            {{ booking.status }}
          </span>
        </div>

        <!-- Card Body -->
        <div class="booking-body">
          <div class="booking-dates">
            <div class="date-item">
              <span class="date-label">Pickup</span>
              <span class="date-value">{{ formatDate(booking.startDate) }}</span>
            </div>
            <div class="date-arrow">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
            </div>
            <div class="date-item">
              <span class="date-label">Return</span>
              <span class="date-value">{{ formatDate(booking.endDate) }}</span>
            </div>
          </div>

          <div class="booking-details">
            <div class="detail">
              <span class="detail-label">Duration</span>
              <span class="detail-value">{{ booking.totalDays }} day{{ booking.totalDays > 1 ? 's' : '' }}</span>
            </div>
            <div class="detail">
              <span class="detail-label">Total</span>
              <span class="detail-value price">{{ formatCurrency(booking.totalPrice) }}</span>
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="booking-footer">
          <span class="booking-id">Booking #{{ booking._id.slice(-8).toUpperCase() }}</span>
          <div class="booking-actions">
            <button
              *ngIf="canCancel(booking)"
              class="btn btn-cancel"
              (click)="openCancelModal(booking)"
            >
              Cancel
            </button>
            <a [routerLink]="['/bookings', booking._id]" class="btn btn-details">
              View Details
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cancel Modal -->
  <div class="modal-overlay" *ngIf="showCancelModal" (click)="closeCancelModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Cancel Booking</h3>
        <button class="modal-close" (click)="closeCancelModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to cancel this booking?</p>
        <div class="modal-booking-info" *ngIf="bookingToCancel">
          <strong>{{ bookingToCancel.trailerTitle }}</strong>
          <span>{{ formatDate(bookingToCancel.startDate) }} - {{ formatDate(bookingToCancel.endDate) }}</span>
        </div>
        <p class="modal-warning">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeCancelModal()">Keep Booking</button>
        <button class="btn btn-danger" (click)="confirmCancel()" [disabled]="isCancelling()">
          <span *ngIf="!isCancelling()">Yes, Cancel</span>
          <span *ngIf="isCancelling()" class="loading-spinner-small"></span>
        </button>
      </div>
    </div>
  </div>
</div>
